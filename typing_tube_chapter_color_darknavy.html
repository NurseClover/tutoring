
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>튜브 타자 연습 - 챕터 선택</title>
  <style>
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background-color: #fceeee;
      margin: 0;
      padding: 20px;
      text-align: center;
      color: black;
    }
    h1 { margin-bottom: 10px; }
    #gameArea {
      position: relative;
      width: 100%;
      height: 400px;
      border: 2px solid #ccc;
      margin: 20px auto;
      overflow: hidden;
      background: #fff;
    }
    .word {
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      border: 1px solid rgba(0,0,0,0.1);
      padding: 4px 8px;
      background-color: rgba(255,255,255,0.95);

      position: absolute;
      font-size: 28px;
      font-weight: bold;
      color: black;
      animation: drop linear forwards;
    }
    @keyframes drop {
      0% { top: 0px; }
      100% { top: 400px; }
    }
    input {
      font-size: 20px;
      padding: 10px;
      width: 300px;
    }
    #status { margin-top: 10px; }
    select {
      font-size: 16px;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>🧪 튜브 타자 연습 - 챕터 선택</h1>
  <p>
    챕터 선택:
    <select id="chapterSelect">
      <option value="random">🎲 랜덤</option>
      <option value="basic">기초 단어</option>
      <option value="medical">의학 용어</option>
      <option value="daily">생활 영어</option>
    </select>
  </p>
  <p>정답 입력: 영어가 떨어지면 한글 입력, 한글이 떨어지면 영어 입력</p>
  <p>🕒 <span id="timer">60</span>초 | ❤️ <span id="life">5</span> | 점수: <span id="score">0</span></p>
  <div id="gameArea"></div>
  <input type="text" id="answerInput" placeholder="정답 입력 후 Enter" autofocus />
  <div id="status"></div>

  <script>
    const wordData = {
      basic: [["apple", "사과"], ["book", "책"]],
      medical: [["nurse", "간호사"], ["hospital", "병원"]],
      daily: [["water", "물"], ["school", "학교"]]
    };

    let selectedWords = [];
    let score = 0;
    let life = 5;
    let timer = 60;
    let speed = 8;
    let activeWords = [];
    let streak = 0;
    let debuff = false;

    const chapterSelect = document.getElementById("chapterSelect");
chapterSelect.addEventListener("change", () => {
  location.reload();
});

    function getWords() {
      const chapter = chapterSelect.value;
      if (chapter === "random") {
        return Object.values(wordData).flat();
      } else {
        return wordData[chapter] || [];
      }
    }

    function updateStatus(text) {
      document.getElementById("status").innerText = text;
    }

    function spawnWord() {
      const area = document.getElementById("gameArea");
      const pair = selectedWords[Math.floor(Math.random() * selectedWords.length)];
      const showKorean = Math.random() < 0.5;
      const text = showKorean ? pair[1] : pair[0];
      const answer = showKorean ? pair[0] : pair[1];
      const colors = ["red", "blue", "yellow", "darkslateblue", "black"];
      const color = colors[Math.floor(Math.random() * colors.length)];

      const div = document.createElement("div");
      div.className = "word";
      div.innerText = text;
      div.dataset.answer = answer;
      div.dataset.color = color;
      div.style.color = color;
      div.style.left = Math.floor(Math.random() * 80) + "%";
      div.style.animationDuration = speed + "s";
      area.appendChild(div);
      activeWords.push(div);

      setTimeout(() => {
        if (activeWords.includes(div)) {
          area.removeChild(div);
          activeWords.splice(activeWords.indexOf(div), 1);
          streak++;
          if (streak >= 10) {
            timer = Math.max(0, timer - 20);
            updateStatus("⚠️ 연속 10개 미입력! 시간 -20초");
            streak = 0;
          }
        }
      }, speed * 1000);
    }

    function startGame() {
      const chapter = chapterSelect.value;
      selectedWords = chapter === "random"
        ? Object.values(wordData).flat()
        : wordData[chapter];
      document.getElementById("score").innerText = score = 0;
      document.getElementById("life").innerText = life = 5;
      document.getElementById("timer").innerText = timer = 60;
      document.getElementById("answerInput").disabled = false;
      setInterval(() => {
        if (!debuff) timer--;
        document.getElementById("timer").innerText = timer;
        if (timer <= 0 || life <= 0) {
          timer = 0;
          document.getElementById("timer").innerText = timer;
          updateStatus("게임 종료! 점수: " + score);
          document.getElementById("answerInput").disabled = true;
        }
      }, 1000);
      setInterval(spawnWord, 2000);
      setInterval(() => {
        if (speed > 3) speed -= 0.5;
      }, 60000);
    }

    document.getElementById("answerInput").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        const val = this.value.trim();
        let matched = false;
        for (let i = 0; i < activeWords.length; i++) {
          const word = activeWords[i];
          if (val === word.dataset.answer) {
            matched = true;
            const color = word.dataset.color;
            score += 10;
            if (color === "red") life++;
            else if (color === "blue") timer += 10;
            else if (color === "darkslateblue") life = Math.max(0, life - 3);
            else if (color === "yellow") {
              debuff = true;
              updateStatus("⚠️ 상태이상! 30초간 시간/생명 멈춤");
              setTimeout(() => {
                debuff = false;
                updateStatus("상태이상 해제!");
              }, 30000);
            }
            document.getElementById("score").innerText = score;
            document.getElementById("life").innerText = life;
            document.getElementById("timer").innerText = timer;
            word.remove();
            activeWords.splice(i, 1);
            streak = 0;
            break;
          }
        }
        if (!matched) {
          timer = Math.max(0, timer - 5);
          updateStatus("❌ 오답! 시간 -5초");
        }
        this.value = "";
      }
    });

    window.onload = startGame;
  </script>
</body>
</html>
