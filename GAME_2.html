<!DOCTYPE html>
<html lang="ko">
 <head>
  <meta charset="utf-8"/>
  <title>
   íƒ€ì ì—°ìŠµ
  </title>
  <style>
   button {
      font-size: 18px;
      padding: 10px 20px;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #ff1493;
    }
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background-color: #fceeee;
      text-align: center;
      padding: 20px;
      color: black;
    }
    #gameArea {
      position: relative;
      width: 100%;
      height: 400px;
      margin: 20px auto;
      overflow: hidden;
      border: 2px solid #ccc;
      background: white;
    }
    .word {
      border-radius: 12px;
      position: absolute;
      font-size: 28px;
      font-weight: bold;
      padding: 4px 8px;
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(0, 0, 0, 0.1);
      animation: drop linear forwards;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
    }
    @keyframes drop {
      0% { top: 0; }
      100% { top: 400px; }
    }
    #inputBox {
      font-size: 20px;
      padding: 10px;
      width: 300px;
    }
    #status {
      margin-top: 10px;
    }
    #gameOverMsg {
      font-size: 32px;
      font-weight: bold;
      color: red;
      margin-top: 20px;
    }
  .home-button {
    display: inline-block;
    padding: 10px 20px;
    background-color: #ffd3e0;
    color: #333;
    border-radius: 10px;
    text-decoration: none;
    font-weight: bold;
    margin-top: 20px;
  }
  .home-button:hover {
    background-color: #ff99bb;
  }
  </style>
 </head>
 <body>
<script>
  // í…Œë§ˆ ì ìš©
  const theme = localStorage.getItem("theme") || "pink";
  document.documentElement.style.setProperty('--main-bg', theme === "sky" ? "#d0f0ff" : "#ffe4f0");

  // ë°°ê²½ìŒ ì ìš©
  const bgm = localStorage.getItem("bgm");
  if (bgm && bgm !== "none") {
    const audio = document.createElement("audio");
    audio.src = bgm;
    audio.autoplay = true;
    audio.loop = true;
    audio.volume = 0.4;
    document.body.appendChild(audio);
  }

  // ì±•í„° ë¶ˆëŸ¬ì˜¤ê¸°
  const chapter = localStorage.getItem("chapter") || "ì „ì²´";
</script>

  <a href="index.html" class="home-button">ğŸ  í™ˆìœ¼ë¡œ ê°€ê¸°</a>
  <div style="max-width: 700px; margin: 0 auto;">
   <h1>
    íƒ€ì ì—°ìŠµ
   </h1>
   <p>
    ì±•í„° ì„ íƒ:
    <select id="chapterSelect">
     <option value="random">
      ëœë¤
     </option>
     <option value="basic">
      ê¸°ì´ˆ ë‹¨ì–´
     </option>
     <option value="medical">
      ì˜í•™ ìš©ì–´
     </option>
    </select>
   </p>
   <p>
    ì •ë‹µ ì…ë ¥: ì˜ì–´ê°€ ë–¨ì–´ì§€ë©´ í•œê¸€ ì…ë ¥, í•œê¸€ì´ ë–¨ì–´ì§€ë©´ ì˜ì–´ ì…ë ¥
   </p>
   <p>
    ì ìˆ˜:
    <span id="score">
     0
    </span>
    | â¤ï¸:
    <span id="life">
     5
    </span>
    | â±ï¸:
    <span id="timer">
     60
    </span>
    ì´ˆ
   </p>
   <div id="gameArea">
   </div>
   <button onclick="startGame()">
    ğŸ® ê²Œì„ ì‹œì‘
   </button>
   <br/>
   <br/>
   <input autofocus="" id="inputBox" placeholder="ì •ë‹µ ì…ë ¥" type="text"/>
   <div id="status">
   </div>
   <div id="debuffNotice" style="margin-top:10px; font-weight:bold; color:orange;">
   </div>
   <div id="gameOverMsg" style="display:none; position:absolute; top:40%; left:50%; transform:translate(-50%,-50%);
     font-size:48px; font-weight:bold; color:red; z-index:100; background:white; padding:20px; border:3px solid red;">
   </div>
   <script>
    const wordData = {
      basic: [["apple", "ì‚¬ê³¼"], ["book", "ì±…"]],
      medical: [["nurse", "ê°„í˜¸ì‚¬"], ["hospital", "ë³‘ì›"]]
    };

    const colors = ["red", "blue", "yellow", "darkslateblue", "black"];
    let selectedWords = [];
    let score = 0, life = 5, timer = 60, speed = 8;
    let activeWords = [];
    let debuff = false;
    let gameInterval, spawnInterval, speedInterval;

    const timerDisplay = document.getElementById("timer");
    const lifeDisplay = document.getElementById("life");
    const scoreDisplay = document.getElementById("score");
    const status = document.getElementById("status");
    const input = document.getElementById("inputBox");

    document.getElementById("chapterSelect").addEventListener("change", () => {
  selectedWords = getWords();
});

    function getWords() {
      const chapter = document.getElementById("chapterSelect").value;
      if (chapter === "random") {
        return Object.values(wordData).flat();
      } else {
        return wordData[chapter] || [];
      }
    }

    function spawnWord() {
      const area = document.getElementById("gameArea");
      const pair = selectedWords[Math.floor(Math.random() * selectedWords.length)];
      const showKorean = Math.random() < 0.5;
      const text = showKorean ? pair[1] : pair[0];
      const answer = showKorean ? pair[0] : pair[1];
      const color = colors[Math.floor(Math.random() * colors.length)];

      const div = document.createElement("div");
      div.className = "word";
      div.innerText = text;
      div.dataset.answer = answer;
      div.style.color = color;
      div.style.left = Math.floor(Math.random() * 80) + "%";
      div.style.animationDuration = speed + "s";
      document.getElementById("gameArea").appendChild(div);
      activeWords.push(div);

      setTimeout(() => {
        if (activeWords.includes(div)) {
          div.remove();
          activeWords.splice(activeWords.indexOf(div), 1);
          if (--life <= 0) endGame();
          lifeDisplay.innerText = life;
        }
      }, speed * 1000);
    }

    function endGame() {
      clearInterval(gameInterval);
      clearInterval(spawnInterval);
      clearInterval(speedInterval);
      input.disabled = true;
      document.getElementById("gameOverMsg").style.display = "block";
      document.getElementById("gameOverMsg").innerHTML = `ê²Œì„ ì˜¤ë²„!<br>ì ìˆ˜: ${score}ì  | ë‚¨ì€ ì‹œê°„: ${timer}ì´ˆ`;
    }

    function startGame() {
      selectedWords = getWords();
      score = 0; life = 5; timer = 60;
      speed = 8;
      scoreDisplay.innerText = score;
      lifeDisplay.innerText = life;
      timerDisplay.innerText = timer;
      input.disabled = false;
      input.value = "";

      gameInterval = setInterval(() => {
        if (!debuff) timer--;
        timerDisplay.innerText = timer;
        if (timer === 300) status.innerText = "âš ï¸ 5ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤!";
        if (timer <= 0 || life <= 0) endGame();
      }, 1000);

      spawnInterval = setInterval(spawnWord, 2000);
      speedInterval = setInterval(() => {
        if (speed > 3) speed -= 0.5;
      }, 60000);
    }

    input.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const val = this.value.trim();
        let matched = false;
        for (let i = 0; i < activeWords.length; i++) {
          const word = activeWords[i];
          if (val.toLowerCase() === word.dataset.answer.toLowerCase()) {
            word.remove();
            activeWords.splice(i, 1);
            matched = true;
            if (debuff) {
      document.getElementById("status").innerText = "âŒ ìƒíƒœì´ìƒ ì¤‘! ì ìˆ˜ëŠ” ì˜¬ë¼ê°€ì§€ë§Œ ì‹œê°„/ìƒëª… ì •ì§€";
    } else {
      document.getElementById("status").innerText = "";
    }
    score += 10;
            scoreDisplay.innerText = score;
            break;
          }
        }
        if (!matched) {
          timer = Math.max(0, timer - 5);
          timerDisplay.innerText = timer;
          status.innerText = "âŒ ì˜¤ë‹µ! -5ì´ˆ";
        } else {
          status.innerText = "";
        }
        this.value = "";
      }
    });
   </script>
  </div>
  <style>
   :root {
    --main-bg: #fceeee;
    --card-color: #d0f0ff;
  }
  body {
    background-color: var(--main-bg);
  }
  .settings {
    margin-top: 20px;
    text-align: center;
  }
  </style>
  <div class="settings">
   <label for="themeSelect">
    ë°°ê²½ í…Œë§ˆ ì„ íƒ:
   </label>
   <select id="themeSelect" onchange="applyThemeToAll()">
    <option value="pink">
     í•‘í¬
    </option>
    <option value="sky">
     í•˜ëŠ˜
    </option>
   </select>
  </div>
  <script>
   function applyThemeToAll() {
  const theme = document.getElementById("themeSelect").value;
  localStorage.setItem("theme", theme);
  const root = document.documentElement;
  if (theme === "sky") {
    root.style.setProperty('--main-bg', '#d0f0ff');
    root.style.setProperty('--card-color', 'white');
  } else {
    root.style.setProperty('--main-bg', '#ffe4f0');
    root.style.setProperty('--card-color', '#d0f0ff');
  }
}
window.onload = () => {
  const saved = localStorage.getItem("theme") || "pink";
  document.getElementById("themeSelect").value = saved;
  applyThemeToAll();
}
  </script>
 </body>
</html>
